<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Mon 1er jeu Phaser</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.51.0/dist/phaser.js">
    </script>

    <style type="text/css"> body 
    
        { margin: 0; 
        }
        
    
    </style>
<script async src='/cdn-cgi/bm/cv/669835187/api.js'></script></head>
<body>
    <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 600, height: 500,
            physics: {
            default: 'arcade',
            arcade: {
            gravity: { y: 1500},
            debug: false
            }},
            scene: {preload: preload, create: create, update: update }
            };

        new Phaser.Game(config);

        function preload(){
        this.load.image("tiles", "assets/sprite_sidescroller.png");
        this.load.tilemapTiledJSON("map", "assets/map.json");  
        this.load.spritesheet('perso','assets/perso.png',
            { frameWidth: 32, frameHeight: 48 });

        }
        var player;
        var cursors;
    
        function create (){
            
            const carteDuNiveau = this.add.tilemap("map");

            // importer TileSet 
            const tileset = carteDuNiveau.addTilesetImage(
                "sprite_sidescroller_map",
                "tiles"
                    ); 
                    
            // importez les layers 1 apr 1 dans l'ordre d'apparition

            const background = carteDuNiveau.createStaticLayer(
"back",
tileset
);
const plateformes = carteDuNiveau.createStaticLayer(
"zero",
tileset
);
            
                   
                       
            player = this.physics.add.sprite(160,300, 'perso') 

            plateformes.setCollisionByProperty({ estSolide: true });       
            this.physics.add.collider(player, plateformes);

            this.physics.world.setBounds(0, 0, 8000, 1000);
            this.cameras.main.setBounds(0, 0, 8000, 1000);
            this.cameras.main.startFollow(player);  

            player.setCollideWorldBounds(true);
        
            this.anims.create({
                key: 'animMarcheGauche',
                frames: this.anims.generateFrameNumbers('perso', {start:0,end:3}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'animDeFace',
                frames: [ { key: 'perso', frame: 4 } ],
                frameRate: 20
            });
            this.anims.create({
                key: 'animMarcheDroite',
                frames: this.anims.generateFrameNumbers('perso', {start:5,end:8}),
                frameRate: 8,
                repeat: -1
            });

  




            // touches clavier
            cursors = this.input.keyboard.createCursorKeys();
            this.keys = this.input.keyboard.addKeys({
                q:  Phaser.Input.Keyboard.KeyCodes.Q,
                d:  Phaser.Input.Keyboard.KeyCodes.D,
                z:  Phaser.Input.Keyboard.KeyCodes.Z,
            });
        }
        
        function update(){
            
            

                if (cursors.up.isDown || this.keys.z.isDown ){
                    if (player.body.blocked.down) {
                        player.setVelocityY(-400);}

                }  

                if (cursors.left.isDown || this.keys.q.isDown){ 
                    player.setVelocityX(-200); 
                    player.anims.play('animMarcheGauche', true);
                }

                else if (cursors.right.isDown || this.keys.d.isDown){ 
                    player.setVelocityX(200);
                    player.anims.play('animMarcheDroite', true);
                }

                else{ 
                    player.setVelocityX(0); 
                    player.anims.play('animDeFace');
                }
                player.setGravity(x = 0 ,y = -500)             
            
                if ((cursors.up.isDown || this.keys.z.isDown )  && player.body.blocked.right ) {
                    player.setVelocityY(-400);
                }  


                if ((cursors.up.isDown || this.keys.z.isDown )  && player.body.blocked.left ) {
                    player.setVelocity(400, -400);
                }  

        }

        function mort (player,obstacles){
            this.scene.restart()
        }

    </script>

<script type="text/javascript">(function(){window['__CF$cv$params']={r:'6d75315e0d940476',m:'a5SyxtvusStKNybgZ1I6imKEgP6FULyM_PjuUUnXsL4-1643823503-0-AUTBAjNNCPtGuVtI4p2SsaXyfAmzEP5J65UuvxH2DMFVQ4osoYzAgBNtjxuBHsAhU13N3LpAgI/LF5Hqy5h5cyE86XkWFTkrUNrRcUQ0fhIrxo8cBVqJEGeIn18q0UKSjMGL4YLXnVQkKIzepUnEwws5kvd6Jt9nbhhXHJjM1+fCnnPlGlfzfDU8S0hRNwN7QQ==',s:[0x5647a12d67,0x92112b06e0],}})();</script></body>
</html>